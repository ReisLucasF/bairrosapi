<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seleção de Municípios por Estado</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="form-group">
        <label for="estadoSelect">Selecione um Estado:</label>
        <select id="estadoSelect" class="form-control">
          <option value="">Selecione...</option>
          <!-- Adicione aqui as opções dos estados -->
        </select>
      </div>
      <div class="form-group">
        <label for="municipioSelect">Selecione um Município:</label>
        <select id="municipioSelect" class="form-control">
          <option value="">Selecione um estado primeiro</option>
        </select>
      </div>
      <div class="form-group">
        <label for="bairroSelect">Selecione um Bairro:</label>
        <select id="bairroSelect" class="form-control">
          <option value="">Selecione um município primeiro</option>
        </select>
      </div>
    </div>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        // Função para carregar os estados
        function carregarEstados() {
          $.get(
            "https://servicodados.ibge.gov.br/api/v1/localidades/estados",
            function (data, status) {
              if (status === "success") {
                data.forEach(function (estado) {
                  $("#estadoSelect").append(
                    '<option value="' +
                      estado.sigla +
                      '">' +
                      estado.nome +
                      "</option>"
                  );
                });
              }
            }
          );
        }

        // Função para carregar os municípios de acordo com o estado selecionado
        function carregarMunicipios(uf) {
          $.get(
            "https://servicodados.ibge.gov.br/api/v1/localidades/estados/" +
              uf +
              "/municipios",
            function (data, status) {
              if (status === "success") {
                $("#municipioSelect").empty();
                $("#municipioSelect").append(
                  '<option value="">Selecione...</option>'
                );
                data.forEach(function (municipio) {
                  $("#municipioSelect").append(
                    '<option value="' +
                      municipio.nome +
                      '">' +
                      municipio.nome +
                      "</option>"
                  );
                });
              }
            }
          );
        }

        // Função para carregar os bairros do JSON local
        function carregarBairros(municipio) {
          $.getJSON("bairros.json", function (data) {
            $("#bairroSelect").empty();
            $("#bairroSelect").append('<option value="">Selecione...</option>');
            $.each(data, function (estado, cidades) {
              $.each(cidades, function (cidade, bairros) {
                if (cidade === municipio) {
                  bairros.forEach(function (bairro) {
                    $("#bairroSelect").append(
                      '<option value="' + bairro + '">' + bairro + "</option>"
                    );
                  });
                }
              });
            });
          });
        }

        // Carregar os estados ao carregar a página
        carregarEstados();

        // Evento de mudança no select de estados
        $("#estadoSelect").change(function () {
          var uf = $(this).val();
          if (uf !== "") {
            carregarMunicipios(uf);
          } else {
            $("#municipioSelect")
              .empty()
              .append('<option value="">Selecione um estado primeiro</option>');
          }
        });

        // Evento de mudança no select de municípios
        $("#municipioSelect").change(function () {
          var municipio = $(this).val();
          if (municipio !== "") {
            carregarBairros(municipio);
          } else {
            $("#bairroSelect")
              .empty()
              .append(
                '<option value="">Selecione um município primeiro</option>'
              );
          }
        });
      });
    </script>
  </body>
</html>
